<link rel="import" href="../polyfills/es6-shim.html">

<script>
  (function () {
    'use strict';

    App.Behaviors = App.Behaviors || {};

    App.Behaviors.DisaggregationBehavior = {

      //Used to display rows for two and three disaggregations.
      //It will NOT work for one and zero disaggregations.
      _determineRows: function(rows, columns, data) {
        var rowsForDisplay = [];

        rows.forEach(function(x) {
          var formatted = '';

          var rowData = columns.map(function(z) {
            formatted = this._formatDisaggregationIds([x.id, z.id]);

            return {
              key: formatted,
              data: data[formatted],
            };
          }, this);

          formatted = this._formatDisaggregationIds([x.id]);

          rowsForDisplay.push({
            title: x.value,
            data: rowData,
            id: x.id,
            total: {
              key: formatted,
              data: data[formatted],
            },
          });
        }, this);

        return rowsForDisplay;
      },

      // Accepts a list of disaggregation IDs, sorts them, and
      // structures them in "()" format for lookup.
      _formatDisaggregationIds: function (unsortedIds) {
        // IDs must be in ascending order.
        var ids = unsortedIds.sort(function (a, b) {return a - b;}).reverse();
        var sortedString = '';

        if (ids.length === 1) {
          sortedString = ids[0] + ',';
        } else {
          sortedString = ids.join(', ');
        }

        return '(' + sortedString + ')';
      },

      _hasDisaggregationData: function (disaggregation, index) {
        return typeof disaggregation[index] !== 'undefined';
      },
    };

}());
</script>
